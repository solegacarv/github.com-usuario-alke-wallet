<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Enviar Dinero | Alke Wallet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body class="bg-light">

  <div class="container py-5">
    <div class="card shadow-sm mx-auto" style="max-width: 600px;">
      <div class="card-body">
        <h3 class="text-center mb-4"><i class="bi bi-send-fill me-2"></i> Enviar Dinero</h3>
        
        <!-- Formulario con validaciones -->
        <form id="sendForm" novalidate>
          <!-- Campo Buscar Contacto con autocompletar -->
          <div class="mb-3">
            <label for="recipient" class="form-label">Buscar Contacto</label>
            <input list="contactsList" class="form-control" id="recipient" placeholder="Escribe o selecciona un contacto" required>
            <datalist id="contactsList">
              <!-- Contactos iniciales -->
              <option value="Juan Soto (Cuenta: 123456789)">
              <option value="Marcela Soto (Cuenta: 987654321)">
              <option value="Carlos Ramírez (Cuenta: 456789123)">
              <option value="Andrea Roa (Cuenta: 741852963)">
            </datalist>
            <div class="invalid-feedback">Por favor selecciona un contacto.</div>
          </div>

          <!-- Monto -->
          <div class="mb-3">
            <label for="amount" class="form-label">Monto</label>
            <input type="number" class="form-control" id="amount" placeholder="Ej: 5000" min="1" required>
            <div class="invalid-feedback">Ingresa un monto válido mayor a 0.</div>
          </div>

          <!-- Descripción -->
          <div class="mb-3">
            <label for="description" class="form-label">Descripción</label>
            <textarea class="form-control" id="description" rows="2" placeholder="Ej: Pago de servicios" required></textarea>
            <div class="invalid-feedback">La descripción es obligatoria.</div>
          </div>

          <!-- Botón enviar -->
          <button type="submit" class="btn custom-btn w-100">Enviar</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Script de validación y autocompletar dinámico -->
  <script>
    (() => {
      'use strict';
      const form = document.getElementById('sendForm');
      const contactsList = document.getElementById('contactsList');

      // Contactos iniciales
      const defaultContacts = [
        {nombre: "Juan Soto", cuenta: "123456789"},
        {nombre: "Marcela Soto", cuenta: "987654321"},
        {nombre: "Carlos Ramírez", cuenta: "456789123"},
        {nombre: "Andrea Roa", cuenta: "741852963"}
      ];

      // Cargar contactos desde localStorage o iniciales
      let savedContacts = JSON.parse(localStorage.getItem('contacts')) || defaultContacts;

      // Renderizar contactos en datalist
      function renderContacts() {
        contactsList.innerHTML = "";
        savedContacts.forEach(c => {
          const option = document.createElement('option');
          option.value = `${c.nombre} (Cuenta: ${c.cuenta})`;
          contactsList.appendChild(option);
        });
      }
      renderContacts();

      // Validación y simulación de transferencia
      form.addEventListener('submit', event => {
        event.preventDefault();
        if (!form.checkValidity()) {
          event.stopPropagation();
          form.classList.add('was-validated');
          return;
        }

        const recipient = document.getElementById('recipient').value;
        const amount = document.getElementById('amount').value;
        const description = document.getElementById('description').value;

        const transaction = {
          destinatario: recipient,
          monto: amount,
          descripcion: description,
          fecha: new Date().toLocaleDateString(),
          hora: new Date().toLocaleTimeString()
        };

        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        transactions.push(transaction);
        localStorage.setItem('transactions', JSON.stringify(transactions));

        alert(`✅ Transferencia simulada:\n\nDestinatario: ${recipient}\nMonto: $${amount}\nDescripción: ${description}\nFecha: ${transaction.fecha} ${transaction.hora}`);

        window.location.href = 'menu.html';
      });
    })();
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>